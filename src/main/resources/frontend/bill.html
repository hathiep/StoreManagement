<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách hóa đơn</title>
    <link rel="stylesheet" type="text/css" href="files/css/ds_bill.css">
    <link rel="stylesheet" type="text/css" href="files/css/main.css">
</head>

<body>
    <!--HEADER-->
    <div class="header">
        <a href="#" title="Quản lý cửa hàng" style="outline:none;">
            <h1>QUẢN LÝ CỬA HÀNG</h1>
        </a>
        <div class="logout">
            Xin chào <b><div id="user-info"></div></b> | <a href="#" title="Log out">Log out</a>
        </div>
        <!--NAVIGATION BAR-->
        <ul class="navigation">
            <a href="Product.html" title="Quản lý sản phẩm">
                <li>Quản lý sản phẩm</li>
            </a>
            <a href="bill.html" title="Nhập hàng" class="navigation-item-selected">
                <li>Quản lý hóa đơn nhập</li>
            </a>
            <a href="createSupplier.html" title="Thêm nhà cung cấp">
                <li>Thêm nhà cung cấp</li>
            </a>
        </ul>
        <!--NAVIGATION BAR-->
    </div>
    <!--END HEADER-->
    <div class="container">
        <h1 style="font-size: 25px; font-weight:bold; color:darkslategrey">Danh sách hóa đơn</h1><br>
        <form id="searchForm">
            <label for="searchDate">Tìm kiếm theo ngày:</label>
            <input type="date" id="searchDate" name="searchDate">
            <button type="submit">Tìm kiếm</button>
        </form><br>
        <table id="billTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ngày</th>
                    <th>Nhà cung cấp</th>
                    <th>Tổng chi phí</th>
                    <th style="width:150px;">
                        <a href="createBill.html" name="btnCreateBill" id="btnCreate" title="Thêm bill mới">+ Thêm mới</a>
                    </th>

                    <!-- Column for buttons -->
                </tr>
            </thead>
            <tbody id="billList">
                <!-- Dữ liệu hóa đơn sẽ được thêm vào đây bằng JavaScript -->
            </tbody>
        </table>
    </div>
    <!--FOOTER-->
    <div class="footer">
        <p><b>Web quản lý nhà hàng</b></p>
        <span style="line-height:18px;">
      <b>Người thực hiện:</b><br/>
      GR_20<br/>
  </span>
    </div>
    <!--END FOOTER-->


    <script>
        // Function to fetch data from API and update table
        function fetchData(date = null) {
            let url = 'http://localhost:8080/api/bills';
            if (date) {
                url = 'http://localhost:8080/api/bill/search?date=' + date;
            }

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const billList = document.getElementById('billList');
                    // Clear previous data
                    billList.innerHTML = '';

                    // Loop through the data and add rows to the table
                    data.forEach(bill => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${bill.id}</td>
                            <td>${bill.date}</td>
                            <td>${bill.supplierName || 'Không có'}</td>
                            <td>${bill.totalCost}</td>
                            <td>
                                <button onclick="editBill(${bill.id})">Sửa</button>
                                <button onclick="deleteBill(${bill.id})">Xóa</button>
                            </td>
                        `;
                        billList.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching bills:', error));
        }

        // Call fetchData function when the page loads
        window.onload = () => fetchData();

        // Search form submission event
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const searchDate = document.getElementById('searchDate').value;
            fetchData(searchDate);
        });

        // Function to handle edit button click
        function editBill(id) {
            // Implement edit functionality here
            console.log('Edit bill with ID:', id);
        }

        // Function to handle delete button click
        function deleteBill(id) {
            // Implement delete functionality here
            console.log('Delete bill with ID:', id);
        }
    </script>
</body>

</html>